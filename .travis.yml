language: go
dist: xenial
sudo: true

matrix:
  include:
  - os: linux
    env:
    - GIMME_OS=linux
      GIMME_ARCH=amd64
      HOST_OS=linux
    go: "1.11"
  - os: linux
    env:
    - GIMME_OS=linux
    - GIMME_ARCH=386
    - HOST_OS=linux
    go: "1.11"
  - os: linux
    env:
    - GIMME_OS=linux
    - GIMME_ARCH=arm64
    - HOST_OS=linux
    go: "1.11"
  - os: linux
    env:
    - GIMME_OS=linux
    - GIMME_ARCH=arm
    - HOST_OS=linux
    go: "1.11"
  - os: linux
    env:
    - GIMME_OS=windows
    - GIMME_ARCH=amd64
    - HOST_OS=linux
    go: "1.11"
  - os: linux
    env:
    - GIMME_OS=windows
    - GIMME_ARCH=386
    - HOST_OS=linux
    go: "1.10"
  - os: osx
    env:
    - GIMME_OS=darwin
    - GIMME_ARCH=amd64
    - HOST_OS=darwin
    go: "1.11"

before_install:
- git fetch --tags
- GOARCH=amd64 GOOS=$HOST_OS go get github.com/mattn/goveralls
- GOARCH=amd64 GOOS=$HOST_OS go get github.com/GeertJohan/go.rice/rice
script:
- GOARCH=$GIMME_ARCH GOOS=$GIMME_OS go get ./...
- GOARCH=$GIMME_ARCH GOOS=$GIMME_OS ./ci/test.sh
- GOARCH=amd64 GOOS=$HOST_OS make vue_production
- GOARCH=amd64 GOOS=$HOST_OS make generate
- GOARCH=$GIMME_ARCH GOOS=$GIMME_OS make dist
# - file remoteSwitch
before_deploy:
- ./ci/pack.sh
deploy:
  provider: releases
  file_glob: true
  file: remoteSwitch-v$TRAVIS_TAG-$GIMME_OS-$GIMME_ARCH.*
  skip_cleanup: true
  api_key:
    secure: JvxzQErWVVDXACpZy3Ob7On8X9htFEjJGGh3Uw7PCktG9Ofu3Y26D1etqJTk4fdidgM3VUKttLWVIvSIElETAlaFMWENyHzZ0Tpb94di7zzZX72fxMWYpItBTd4gmK36HmtlkdVWFHLFvVK3VMxRViW5HEp6DEGMvIIVcbGBnnI/12p/6K4vZWQbx+fp/gcZz+HXo4vC1PFlN/L9WBW1xBs9sFM7QgvsGRARYwnvmUsfSdaRpCsQu6FKFGXrOUA0m2R2296Hd7l2Sv7twV+2C5slA1HvvyhDGTYNCYKIwGCfbLXkS+132azocpaCzbsdQ5xvo9nPE2JOgyGuv0IQO3iAnPcppqCZl1zYM+6LkJy9Gb06Zg9czfIaW2OZv22BzQEXwQqADOZnnxXG0/mgehWon076cOhlqk7B8u5m5bgtKzO2JYjDIXxpnpLO7G47PR3A2NGr/6wJO+EJnrgkk2Rf3KKH/G2L1Y4lAn3w6LK+2wq3R1nIiByyTKkKGDWWNuTMUYysovkjr9lLkjnHW2XPiiuYEN+vnRh9+bXIs/ev+wib0r4cZbLDchq0q00h5Pz8PmijzsScJQNx0ouJPS37VPPVxhyI5r3gDJ9Y3jyYZ9pwim/9//TN6X7jvoXC4ooUwPiwFQPHRq6OTCLZKc+Mec+TOHJz8h0j/PbkWmI=
  on:
    repo: dh1tw/remoteSwitch
    # tags: true
    draft: true
    branch: travis-deploy